# Docker Compose - Dev Mode (VPS)
# Uses existing PostgreSQL on host (trackrecord_postgres_enclave:5436)
# Usage: docker-compose -f docker-compose.dev.yml up -d --build

services:
  # =============================================
  # Enclave TS - Simulated TEE Environment
  # =============================================
  enclave-ts:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: enclave-ts:dev
    container_name: enclave_ts_dev
    network_mode: host
    environment:
      - NODE_ENV=development
      - DATABASE_URL=postgresql://enclave_user:EnclavePass2026Strong@127.0.0.1:5436/enclave_db?schema=public
      - ENCRYPTION_KEY=0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef
      - JWT_SECRET=local-dev-jwt-secret
      - ENCLAVE_PORT=50053
      - REST_PORT=3050
      - SKIP_ATTESTATION=true
      - GRPC_INSECURE=true
      - ENABLE_ENCLAVE_LOG_STREAMING=true
      - ENABLE_DAILY_SYNC=true
      - LOG_LEVEL=debug
    restart: unless-stopped
    # --- TEE Simulation Constraints ---
    security_opt:
      - no-new-privileges:true
    read_only: true
    tmpfs:
      - /tmp
    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M
